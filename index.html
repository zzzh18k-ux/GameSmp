<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FRUIT COIN ARCADE</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@700&family=Nunito:wght@700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* === TEMA ARCADE NE√ìN === */
        :root { 
            --bg-dark: #0a001a;
            --neon-blue: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-gold: #ffd700;
            --text-glow: #fff;
            --panel-bg: rgba(20, 20, 40, 0.9);
        }
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-dark); 
            background-image: 
                linear-gradient(rgba(10,0,26,0.9), rgba(10,0,26,0.9)),
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 243, 255, 0.1) 2px, rgba(0, 243, 255, 0.1) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255, 0, 255, 0.1) 2px, rgba(255, 0, 255, 0.1) 4px);
            background-size: 100% 100%, 20px 20px, 20px 20px;
            color: var(--text-glow); 
            font-family: 'Nunito', sans-serif;
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; 
            padding: 20px; padding-bottom: 120px; 
            overflow-y: auto;
        }

        /* Marco de la M√°quina Arcade */
        .app-container { 
            width: 100%; max-width: 400px; 
            display: flex; flex-direction: column; align-items: center; gap: 15px; position: relative;
            border: 4px solid var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue), inset 0 0 20px var(--neon-blue);
            border-radius: 20px;
            padding: 20px;
            background: var(--panel-bg);
            animation: borderPulse 4s infinite alternate;
        }
        @keyframes borderPulse { 0% { border-color: var(--neon-blue); box-shadow: 0 0 20px var(--neon-blue), inset 0 0 10px var(--neon-blue); } 100% { border-color: var(--neon-pink); box-shadow: 0 0 25px var(--neon-pink), inset 0 0 15px var(--neon-pink); } }

        #banScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 99999; display: none; justify-content: center; align-items: center; text-align: center; color: red; font-family: 'Press Start 2P'; }

        /* HEADER & SCORE */
        .main-title { font-family: 'Orbitron', sans-serif; font-size: 24px; color: var(--neon-gold); text-shadow: 0 0 10px var(--neon-gold); text-align: center; margin-bottom: 10px; letter-spacing: 2px; }

        .score-board {
            background: linear-gradient(180deg, #222, #111);
            padding: 15px 25px; border-radius: 15px; border: 2px solid var(--neon-blue);
            display: flex; flex-direction: column; align-items: center; width: 100%;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
        }
        .score-title { font-family: 'Press Start 2P'; font-size: 10px; color: var(--neon-blue); margin-bottom: 5px; }
        .score-val { font-family: 'Press Start 2P', cursive; font-size: 35px; color: var(--neon-gold); line-height: 1; margin-bottom: 10px; text-shadow: 0 0 10px var(--neon-gold); }

        /* BARRA DE PROGRESO NE√ìN */
        .goal-container { width: 100%; margin-top: 5px; }
        .goal-bar-bg { width: 100%; height: 14px; background: #000; border-radius: 10px; overflow: hidden; border: 2px solid #333; box-shadow: inset 0 0 5px #000; }
        .goal-bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink)); transition: width 0.3s; box-shadow: 0 0 10px var(--neon-blue); }
        .goal-text { font-family: 'Orbitron'; font-size: 10px; color: #aaa; margin-top: 6px; display: flex; justify-content: space-between; font-weight: bold; }

        /* ZONA DE JUEGO ARCADE */
        .game-area { 
            width: 100%; height: 260px; display: flex; justify-content: center; align-items: center; position: relative; 
            background: radial-gradient(circle, rgba(0,0,0,0) 0%, rgba(0,0,0,0.8) 100%);
            border-radius: 15px; border: 2px dashed rgba(255,255,255,0.1);
        }
        
        .fruit-btn {
            font-size: 130px; cursor: pointer; transition: transform 0.1s; position: relative; z-index: 5;
            filter: drop-shadow(0 0 20px var(--neon-gold));
            animation: floatFruit 3s ease-in-out infinite;
        }
        @keyframes floatFruit { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-10px) scale(1.02); } }
        .fruit-btn:active { transform: scale(0.9) rotate(5deg) !important; filter: drop-shadow(0 0 30px red); }

        /* EFECTOS DE PART√çCULAS DIGITALES */
        .particle { position: absolute; width: 6px; height: 6px; background: var(--neon-gold); box-shadow: 0 0 5px var(--neon-gold); pointer-events: none; animation: popDigital 0.6s ease-out forwards; }
        @keyframes popDigital { 0% { transform: translate(0, 0) scale(1); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; } }
        .float-plus { position: absolute; font-family: 'Press Start 2P'; font-size: 20px; color: var(--neon-blue); pointer-events: none; animation: floatUpDigital 0.8s forwards; text-shadow: 0 0 5px var(--neon-blue); }
        @keyframes floatUpDigital { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-80px) scale(1.2); opacity: 0; } }

        /* BARRA DE ENERG√çA CIBERN√âTICA */
        .energy-container { width: 100%; background: linear-gradient(180deg, #222, #111); padding: 12px 15px; border-radius: 15px; border: 2px solid var(--neon-pink); text-align: center; box-shadow: 0 0 10px rgba(255, 0, 255, 0.3); }
        .energy-track { width: 100%; height: 10px; background: #000; border-radius: 10px; overflow: hidden; margin: 5px 0; border: 1px solid #333; }
        .energy-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #ff4757, var(--neon-pink)); transition: width 0.2s; box-shadow: 0 0 5px var(--neon-pink); }
        .energy-text { font-family: 'Orbitron'; font-size: 10px; font-weight: bold; color: var(--text-glow); display: flex; justify-content: space-between; }

        /* OVERLAY DE RECARGA "GAME OVER" */
        .refill-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 10; border-radius: 15px;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            border: 3px solid red; box-shadow: inset 0 0 20px red;
        }
        .btn-refill {
            background: red; color: white; padding: 15px 30px; border-radius: 5px;
            border: 3px solid #ff0000; font-family: 'Orbitron'; font-weight: 900; font-size: 16px; cursor: pointer;
            box-shadow: 0 0 20px red; animation: pulseRed 1s infinite; text-transform: uppercase;
        }
        @keyframes pulseRed { 0% { box-shadow: 0 0 20px red; scale: 1; } 50% { box-shadow: 0 0 40px red; scale: 1.05; } 100% { box-shadow: 0 0 20px red; scale: 1; } }

        /* BOTONES DE BONUS MET√ÅLICOS */
        .bonus-row { display: flex; gap: 10px; width: 100%; margin-top: 5px; }
        .btn-bonus {
            flex: 1; padding: 12px; border-radius: 10px; border: 2px solid #555; 
            background: linear-gradient(180deg, #333, #111); color: #fff; font-family: 'Orbitron'; font-size: 10px;
            cursor: pointer; display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 4px 0 #000; transition: all 0.1s; text-shadow: 0 0 5px rgba(255,255,255,0.3);
        }
        .btn-bonus:active { transform: translateY(4px); box-shadow: none; }
        .b-adsgram { border-color: var(--neon-blue); color: var(--neon-blue); }
        .b-monetag { border-color: var(--neon-gold); color: var(--neon-gold); }

        /* BOT√ìN DE RETIRO ARCADE */
        .btn-withdraw { 
            background: #333; color: #777; width: 100%; padding: 18px; border: 3px solid #555; 
            border-radius: 12px; font-family: 'Press Start 2P'; font-size: 12px; margin-top: 15px; 
            cursor: not-allowed; box-shadow: inset 0 0 10px #000; transition: 0.3s; text-align: center;
        }
        .btn-withdraw.ready {
            background: linear-gradient(45deg, var(--neon-green), #00ff00); color: #000;
            border-color: #00ff00; cursor: pointer;
            box-shadow: 0 0 30px #00ff00; animation: pulseGreen 1.5s infinite; 
            text-shadow: none;
        }
        @keyframes pulseGreen { 0% { box-shadow: 0 0 20px #00ff00; } 50% { box-shadow: 0 0 40px #00ff00; } 100% { box-shadow: 0 0 20px #00ff00; } }

        .mini-menu { display: flex; gap: 8px; width: 100%; margin-top: 10px; }
        .btn-mini {
            flex: 1; background: transparent; border: 1px solid var(--neon-blue); color: var(--neon-blue);
            padding: 8px; border-radius: 5px; font-size: 10px; font-family: 'Orbitron';
            cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 5px; transition: 0.2s;
        }
        .btn-mini:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 10px var(--neon-blue); }

        /* MODAL CIBERN√âTICO */
        #modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; justify-content:center; align-items:center; z-index:100; }
        .modal-card { background: #111; padding: 25px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; border: 3px solid var(--neon-green); box-shadow: 0 0 30px var(--neon-green); }
        .btn-green { background: var(--neon-green); color: #000; width: 100%; padding: 15px; border-radius: 5px; border: none; font-family: 'Press Start 2P'; font-size: 12px; margin-top: 15px; cursor: pointer; box-shadow: 0 0 15px var(--neon-green); }
    </style>
</head>
<body>

    <div id="banScreen"><h2>GAME OVER</h2><p>Multicuenta Detectada</p></div>

    <div class="app-container" id="appContent">
        <div class="main-title">FRUIT COIN BOT</div>
        
        <div class="score-board">
            <div class="score-title">SCORE</div>
            <div class="score-val" id="score">0</div>
            <div class="goal-container">
                <div class="goal-bar-bg"><div class="goal-bar-fill" id="goalBar"></div></div>
                <div class="goal-text"><span>PROGRESO</span><span style="color:var(--neon-blue);">META: $0.10 USD</span></div>
            </div>
        </div>

        <div class="game-area">
            <div class="fruit-btn" id="fruit" onclick="tap(event)">üçä</div>
            
            <div class="refill-overlay" id="refillOverlay">
                <div style="font-size:50px; margin-bottom:10px; color: red; text-shadow: 0 0 10px red;">‚ö°</div>
                <h3 style="color:white; margin-bottom:5px; font-family:'Orbitron';">SIN ENERG√çA</h3>
                <p style="color:#aaa; margin-bottom:20px; font-size:12px; font-family:'Orbitron';">INSERT COIN (Ver Video)</p>
                <button class="btn-refill" onclick="refillEnergy()">
                    <i class="fa-solid fa-play"></i> VER VIDEO (+50‚ö°)
                </button>
            </div>
        </div>

        <div class="energy-container">
            <div class="energy-text"><span>ENERG√çA</span><span id="energyText">100/100</span></div>
            <div class="energy-track"><div class="energy-fill" id="energyBar"></div></div>
        </div>

        <div class="bonus-row">
            <button class="btn-bonus b-adsgram" onclick="watchEnergyBonus('adsgram')">
                <i class="fa-solid fa-bolt" style="margin-bottom:3px;"></i><span>+15 POWER</span>
            </button>
            <button class="btn-bonus b-monetag" onclick="watchEnergyBonus('monetag')">
                <i class="fa-solid fa-battery-full" style="margin-bottom:3px;"></i><span>+10 POWER</span>
            </button>
        </div>

        <button class="btn-withdraw" id="withdrawBtn" onclick="retirar()">
            <i class="fa-solid fa-lock"></i> META NO ALCANZADA
        </button>

        <div class="mini-menu">
            <button class="btn-mini" onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')"><i class="fa-solid fa-headset"></i> Soporte</button>
            <button class="btn-mini" onclick="tg.openTelegramLink('https://t.me/noticebuddy')"><i class="fa-brands fa-telegram"></i> Canal</button>
        </div>
    </div>

    <div id="modal">
        <div class="modal-card">
            <h2 style="color:var(--neon-green); margin-bottom:15px; font-family:'Orbitron'; text-shadow: 0 0 10px;">‚úÖ ¬°META ALCANZADA!</h2>
            <p style="color:#ccc; font-size:13px; margin-bottom:15px; font-family:'Orbitron';">Toma captura para tu pago.</p>
            <div style="background:#222; padding:15px; border-radius:10px; margin-bottom:15px; text-align:left; font-size:12px; color:#fff; border: 2px dashed var(--neon-blue); font-family: 'Orbitron';">
                <div><b>USUARIO:</b> <span id="recUser" style="color:var(--neon-blue);">...</span></div>
                <div><b>FECHA:</b> <span id="recDate" style="color:var(--neon-blue);">...</span></div>
                <div style="margin-top:10px; font-size:16px; color:var(--neon-green); font-weight:bold;"><b>TOTAL: $0.10 USD</b></div>
            </div>
            <button class="btn-green" onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')">üì© ENVIAR CAPTURA</button>
            <button style="background:none; border:none; color:#aaa; margin-top:15px; cursor:pointer; font-family:'Orbitron';" onclick="location.reload()">Cerrar</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        // Colores de cabecera ajustados al tema oscuro
        tg.setHeaderColor('#0a001a'); tg.setBackgroundColor('#0a001a');

        const ADSGRAM_ID = "18897"; 
        
        // üõ°Ô∏è LLAVE DE SEGURIDAD (Mantiene el saldo del usuario)
        const KEY = 'fruit_v95_prod'; 
        
        const META = 20000; 
        let user = { pts: 0, energy: 100 };

        // Efectos de sonido
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(type) {
            try {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);

                if (type === 'tap') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                    osc.start(); osc.stop(audioCtx.currentTime + 0.1);
                } else if (type === 'success') {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                    osc.frequency.linearRampToValueAtTime(1200, audioCtx.currentTime + 0.3);
                    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    osc.start(); osc.stop(audioCtx.currentTime + 0.5);
                }
            } catch(e) {}
        }

        window.onload = function() {
            // Anti-Multicuenta
            const cid = tg.initDataUnsafe?.user?.id || 12345; 
            const sid = localStorage.getItem('did');
            if (sid && sid != cid) {
                document.getElementById('banScreen').style.display = 'flex';
                return;
            } 
            if (!sid) localStorage.setItem('did', cid);

            // üöë SISTEMA DE RECUPERACI√ìN INTELIGENTE (MIGRACI√ìN SEGURA)
            if(localStorage.getItem(KEY)) {
                let rawData = localStorage.getItem(KEY);
                try {
                    // Intento 1: Leer el formato Antiguo (no encriptado)
                    if (rawData.trim().startsWith("{")) {
                        console.log("Detectados datos antiguos (600 puntos). Migrando a formato seguro.");
                        let saved = JSON.parse(rawData);
                        user.pts = parseInt(saved.pts) || 0;
                        user.energy = (saved.energy !== undefined) ? parseInt(saved.energy) : 100;
                        // Guardamos inmediatamente en formato NUEVO seguro
                        save(); 
                    } 
                    // Intento 2: Leer el formato Nuevo (encriptado)
                    else {
                        let decoded = atob(rawData); // Desencriptar
                        let saved = JSON.parse(decoded);
                        user.pts = parseInt(saved.pts) || 0;
                        user.energy = (saved.energy !== undefined) ? parseInt(saved.energy) : 100;
                    }
                } catch(e) {
                    console.log("Error de lectura o datos corruptos despu√©s del clic. Reiniciando a 0.", e);
                    // Si falla la lectura, no hay m√°s opci√≥n que empezar de 0
                }
            }
            updateUI();
        };

        function updateUI() {
            const scoreEl = document.getElementById('score');
            scoreEl.innerText = user.pts;
            
            document.getElementById('energyText').innerText = `${user.energy}/100`;
            document.getElementById('energyBar').style.width = `${Math.min(user.energy, 100)}%`;
            
            let pct = (user.pts / META) * 100;
            if(pct > 100) pct = 100;
            document.getElementById('goalBar').style.width = `${pct}%`;

            const wBtn = document.getElementById('withdrawBtn');
            if (user.pts >= META) {
                wBtn.classList.add('ready');
                // Icono de dinero y texto estilo arcade
                wBtn.innerHTML = '<i class="fa-solid fa-coins"></i> ¬°RETIRAR $0.10 USD!';
            } else {
                wBtn.classList.remove('ready');
                wBtn.innerHTML = `<i class="fa-solid fa-lock"></i> META NO ALCANZADA`;
            }
            
            if(user.energy <= 0) {
                document.getElementById('refillOverlay').style.display = 'flex';
            } else {
                document.getElementById('refillOverlay').style.display = 'none';
            }
        }

        // üõ°Ô∏è Guardar con SEGURIDAD (Encriptado)
        function save() { 
            try {
                // btoa() encripta los datos a Base64
                let encrypted = btoa(JSON.stringify(user));
                localStorage.setItem(KEY, encrypted); 
            } catch(e) {
                console.error("Error al guardar");
            }
            updateUI(); 
        }

        function tap(e) {
            if(user.energy <= 0) return;

            user.pts += 1;
            user.energy -= 1;
            save();
            playSfx('tap');

            const el = document.createElement('div');
            el.className = 'float-plus';
            el.innerText = '+1';
            e
