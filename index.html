<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Burger Tycoon</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* TEMA BURGER */
        :root { --bg: #2c1e16; --card: #3e2723; --orange: #ff6f00; --yellow: #ffca28; --green: #4caf50; --red: #f44336; --text: #fff; }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg); color: var(--text); font-family: 'Roboto', sans-serif;
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; 
            padding: 15px; padding-bottom: 50px;
            background-image: radial-gradient(#4e342e 1px, transparent 1px); background-size: 20px 20px;
        }

        #banScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 99999; 
            display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }

        .app-container { width: 100%; max-width: 450px; display: flex; flex-direction: column; gap: 15px; }

        /* HEADER RESUMEN */
        .stats-bar {
            display: flex; gap: 10px;
        }
        .stat-box {
            flex: 1; background: var(--card); border: 2px solid #5d4037; border-radius: 15px; padding: 10px;
            display: flex; flex-direction: column; align-items: center; position: relative;
        }
        .stat-icon { font-size: 20px; margin-bottom: 5px; }
        .stat-val { font-family: 'Fredoka One', cursive; font-size: 18px; }
        .stat-label { font-size: 10px; color: #aaa; text-transform: uppercase; }

        /* CIRCULO DE VENTA (HAMBURGUESA) */
        .game-zone {
            position: relative; height: 250px; display: flex; justify-content: center; align-items: center;
            background: url('https://img.freepik.com/free-vector/restaurant-mural-wallpaper_23-2148706001.jpg?w=740'); /* Fondo opcional */
            background-size: cover; border-radius: 20px; border: 4px solid #5d4037; overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
        }
        .burger-btn {
            font-size: 100px; cursor: pointer; transition: transform 0.1s; z-index: 10;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.5));
        }
        .burger-btn:active { transform: scale(0.9); }
        
        /* STOCK ALERT */
        .stock-alert {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 20; display: none;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        .stock-btn {
            background: var(--green); color: white; border: none; padding: 15px 30px;
            border-radius: 50px; font-weight: bold; font-size: 16px; margin-top: 10px;
            cursor: pointer; box-shadow: 0 0 20px rgba(76, 175, 80, 0.5); animation: pulse 1.5s infinite;
        }
        .stock-wait { font-size: 12px; color: #aaa; margin-top: 15px; text-decoration: underline; cursor: pointer; }

        /* BARRA DE PROGRESO */
        .progress-container { background: #222; border-radius: 10px; padding: 10px; border: 1px solid #444; }
        .prog-bar { height: 10px; background: #111; border-radius: 5px; overflow: hidden; margin: 5px 0; }
        .prog-fill { height: 100%; width: 0%; background: var(--yellow); transition: 0.3s; }
        .prog-text { display: flex; justify-content: space-between; font-size: 11px; color: #ccc; font-weight: bold; }

        /* MEJORAS (LOS 7 ANUNCIOS) */
        .upgrades-title { font-family: 'Fredoka One', cursive; color: var(--yellow); margin-top: 10px; font-size: 18px; text-align: center; }
        .upgrade-list { display: flex; flex-direction: column; gap: 8px; }
        
        .upgrade-item {
            background: var(--card); border: 1px solid #5d4037; padding: 12px; border-radius: 12px;
            display: flex; align-items: center; justify-content: space-between; cursor: pointer;
        }
        .upgrade-item:active { background: #4e342e; }
        .up-icon { font-size: 24px; color: var(--orange); width: 40px; text-align: center; }
        .up-info h4 { margin: 0; font-size: 14px; font-weight: bold; }
        .up-info p { margin: 0; font-size: 10px; color: #888; }
        .up-cost { background: #222; padding: 5px 10px; border-radius: 5px; font-size: 11px; color: var(--yellow); font-weight: bold; }

        .upgrade-item.locked { opacity: 0.6; filter: grayscale(1); pointer-events: none; }

        /* FLOTANTES */
        .float-plus { position: absolute; color: var(--green); font-weight: bold; font-size: 24px; pointer-events: none; animation: floatUp 0.8s forwards; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-50px); opacity: 0; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* MODAL */
        #receiptModal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; justify-content:center; align-items:center; flex-direction:column; z-index:100; padding: 30px; }
        .modal-box { background: var(--card); padding: 30px; border-radius: 20px; border: 2px solid var(--orange); width: 100%; text-align: center; }
        .btn-withdraw { background: var(--green); color: white; width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; font-size: 16px; margin-top: 15px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="banScreen">
        <h2>RESTAURANTE CLAUSURADO</h2>
        <p>Multicuenta detectada.<br>ID: <span id="linkedID">...</span></p>
    </div>

    <div class="app-container" id="appContent">
        
        <div class="stats-bar">
            <div class="stat-box">
                <i class="fa-solid fa-cash-register stat-icon" style="color:var(--green);"></i>
                <div class="stat-val" id="moneyDisplay">0</div>
                <div class="stat-label">CAJA CHICA</div>
            </div>
            <div class="stat-box">
                <i class="fa-solid fa-boxes-stacked stat-icon" style="color:var(--orange);"></i>
                <div class="stat-val" id="stockDisplay">20</div>
                <div class="stat-label">INGREDIENTES</div>
            </div>
        </div>

        <div class="progress-container">
            <div class="prog-text"><span>PROGRESO DE RETIRO</span><span>$0.10</span></div>
            <div class="prog-bar"><div class="prog-fill" id="progFill"></div></div>
            <div class="prog-text"><span id="pctDisplay">0%</span><span>2,500 Pts</span></div>
        </div>

        <div class="game-zone">
            <div class="burger-btn" onclick="sellBurger(event)">üçî</div>
            
            <div class="stock-alert" id="stockAlert">
                <i class="fa-solid fa-triangle-exclamation" style="font-size:40px; color:var(--red); margin-bottom:10px;"></i>
                <h3 style="color:white; margin-bottom:5px;">¬°SIN INGREDIENTES!</h3>
                <p style="font-size:12px; color:#ccc; margin-bottom:15px;">El restaurante no puede cocinar.</p>
                
                <button class="stock-btn" onclick="restockExpress()">
                    <i class="fa-solid fa-truck-fast"></i> RECARGA EXPRESS (+50)
                </button>
                <div class="stock-wait" onclick="restockFree()">Recarga Lenta (Esperar 10s)</div>
            </div>
        </div>

        <div class="upgrades-title">MEJORAS DEL LOCAL</div>
        <div class="upgrade-list">
            
            <div class="upgrade-item" id="up1" onclick="buyUpgrade(1, 'adsgram')">
                <div class="up-icon"><i class="fa-solid fa-chair"></i></div>
                <div class="up-info"><h4>Nuevas Sillas</h4><p id="t1">Disponible</p></div>
                <div class="up-cost">BONO +15</div>
            </div>

            <div class="upgrade-item" id="up2" onclick="buyUpgrade(2, 'monetag')">
                <div class="up-icon"><i class="fa-solid fa-palette"></i></div>
                <div class="up-info"><h4>Decoraci√≥n</h4><p id="t2">Disponible</p></div>
                <div class="up-cost">BONO +10</div>
            </div>

            <div class="upgrade-item" id="up3" onclick="buyUpgrade(3, 'adsgram')">
                <div class="up-icon"><i class="fa-solid fa-utensils"></i></div>
                <div class="up-info"><h4>Cubiertos Oro</h4><p id="t3">Disponible</p></div>
                <div class="up-cost">BONO +20</div>
            </div>

            <div class="upgrade-item" id="up4" onclick="buyUpgrade(4, 'monetag')">
                <div class="up-icon"><i class="fa-solid fa-music"></i></div>
                <div class="up-info"><h4>M√∫sica Ambiente</h4><p id="t4">Disponible</p></div>
                <div class="up-cost">BONO +8</div>
            </div>

            <div class="upgrade-item" id="up5" onclick="buyUpgrade(5, 'adsgram')">
                <div class="up-icon"><i class="fa-solid fa-fire-burner"></i></div>
                <div class="up-info"><h4>Horno Industrial</h4><p id="t5">Disponible</p></div>
                <div class="up-cost">BONO +25</div>
            </div>

            <div class="upgrade-item" id="up6" onclick="buyUpgrade(6, 'monetag')">
                <div class="up-icon"><i class="fa-solid fa-user-tie"></i></div>
                <div class="up-info"><h4>Contratar Chef</h4><p id="t6">Disponible</p></div>
                <div class="up-cost">BONO +12</div>
            </div>

            <div class="upgrade-item" id="up7" onclick="buyUpgrade(7, 'adsgram')">
                <div class="up-icon"><i class="fa-solid fa-store"></i></div>
                <div class="up-info"><h4>Ampliar Local</h4><p id="t7">Disponible</p></div>
                <div class="up-cost">BONO +15</div>
            </div>

        </div>

        <button class="btn-withdraw" onclick="retirar()">
            <i class="fa-solid fa-sack-dollar"></i> RETIRAR GANANCIAS ($0.10)
        </button>

        <div style="text-align:center; font-size:10px; color:#666; margin-top:10px;">
            <span onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')">SOPORTE</span>
        </div>

    </div>

    <div id="receiptModal">
        <div class="modal-box">
            <h2 style="color:var(--orange);">¬°ORDEN LISTA!</h2>
            <p style="font-size:12px; color:#ccc;">Env√≠a este ticket al gerente.</p>
            <hr style="border:1px dashed #555; margin:15px 0;">
            <div style="display:flex; justify-content:space-between; color:#fff; font-size:12px;"><span>SOCIO:</span><span id="recUser">...</span></div>
            <div style="display:flex; justify-content:space-between; color:#fff; font-size:12px; margin-top:5px;"><span>FECHA:</span><span id="recDate">...</span></div>
            <div style="display:flex; justify-content:space-between; color:var(--yellow); font-size:14px; margin-top:10px; font-weight:bold;"><span>PAGO:</span><span>$0.10 USD</span></div>
            
            <button class="btn-withdraw" onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')">ENVIAR TICKET</button>
            <button style="background:none; border:none; color:#666; margin-top:10px;" onclick="location.reload()">Cerrar</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        tg.setHeaderColor('#2c1e16'); tg.setBackgroundColor('#2c1e16');

        const ADSGRAM_ID = "18841"; 
        const MEMORY_KEY = 'burger_tycoon_v89';
        const META = 2500;
        const COOLDOWN = 24 * 60 * 60 * 1000; // 24 Horas para las mejoras

        let user = { money: 0, stock: 20, timers: {} };
        for(let i=1; i<=7; i++) { if(!user.timers[i]) user.timers[i] = 0; }

        window.onload = function() {
            // Anti-Multi
            const cid = tg.initDataUnsafe?.user?.id || 12345; 
            const sid = localStorage.getItem('did');
            if (sid && sid != cid) {
                document.getElementById('appContent').style.display = 'none';
                document.getElementById('banScreen').style.display = 'flex';
                document.getElementById('linkedID').innerText = sid;
                return; 
            } 
            if (!sid) localStorage.setItem('did', cid);

            if(localStorage.getItem(MEMORY_KEY)) { 
                let saved = JSON.parse(localStorage.getItem(MEMORY_KEY));
                user.money = parseInt(saved.money) || 0;
                user.stock = parseInt(saved.stock) || 20;
                user.timers = saved.timers || user.timers;
            }
            updateUI();
            setInterval(checkTimers, 1000);
        };

        function updateUI() { 
            document.getElementById('moneyDisplay').innerText = user.money;
            document.getElementById('stockDisplay').innerText = user.stock;
            
            let pct = (user.money / META) * 100;
            if(pct > 100) pct = 100;
            document.getElementById('progFill').style.width = pct + "%";
            document.getElementById('pctDisplay').innerText = Math.floor(pct) + "%";

            // Control de Stock
            if(user.stock <= 0) {
                document.getElementById('stockAlert').style.display = 'flex';
            } else {
                document.getElementById('stockAlert').style.display = 'none';
            }
            
            checkTimers();
        }
        function save() { localStorage.setItem(MEMORY_KEY, JSON.stringify(user)); updateUI(); }

        // --- GAMEPLAY B√ÅSICO (GRATIS) ---
        function sellBurger(e) {
            if(user.stock <= 0) return; // No stock = No venta

            user.money += 1;
            user.stock -= 1;
            save();
            
            // Efecto
            const el = document.createElement('div');
            el.className = 'float-plus';
            el.innerText = '+$1';
            el.style.left = e.clientX + 'px';
            el.style.top = e.clientY + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
            tg.HapticFeedback.impactOccurred('light');
        }

        // --- SISTEMA DE RECARGA (EL GANCHO DEL ANUNCIO) ---
        function restockExpress() {
            // ADSGRAM OBLIGATORIO (Es la forma principal de ganar)
            const AdController = window.Adsgram.init({ blockId: ADSGRAM_ID });
            AdController.show().then(()=>{ 
                user.stock += 50; // Recarga grande
                save();
                tg.showPopup({ title: "¬°ENTREGA RECIBIDA!", message: "+50 Ingredientes listos." });
            }).catch(()=>{ 
                // Si falla Adsgram, intentamos Monetag
                if(typeof show_10278425 === 'function') {
                    show_10278425().then(()=>{
                        user.stock += 50; save();
                        tg.showPopup({ title: "¬°ENTREGA RECIBIDA!", message: "+50 Ingredientes listos." });
                    }).catch(()=>{ tg.showAlert("Proveedor ocupado. Intenta de nuevo."); });
                }
            });
        }

        function restockFree() {
            tg.showAlert("Esperando cami√≥n de reparto... (Simulaci√≥n: 10s)");
            setTimeout(() => {
                user.stock += 5; // Recarga peque√±a
                save();
                tg.showPopup({ title: "Entrega Lenta", message: "+5 Ingredientes (Vio un video y gana m√°s)" });
            }, 10000);
        }

        // --- MEJORAS DEL LOCAL (ADS DIARIOS) ---
        function checkTimers() {
            const now = Date.now();
            for(let i=1; i<=7; i++) {
                const row = document.getElementById('up'+i);
                const txt = document.getElementById('t'+i);
                if(now < user.timers[i]) {
                    row.classList.add('locked');
                    const h = Math.floor((user.timers[i] - now) / 3600000);
                    txt.innerText = `Instalando: ${h}h restantes`;
                } else {
                    row.classList.remove('locked');
                    txt.innerText = "Disponible para instalar";
                }
            }
        }

        function buyUpgrade(id, provider) {
            const row = document.getElementById('up'+id);
            if(row.classList.contains('locked')) return;

            // Random Reward (8 a 25 puntos)
            let reward = Math.floor(Math.random() * (25 - 8 + 1)) + 8;

            if(Math.random() < 0.5) {
                const AdController = window.Adsgram.init({ blockId: ADSGRAM_ID });
                AdController.show().then(()=>{ payUpgrade(id, reward); }).catch(()=>{ tryMonetagUpgrade(id, reward); });
            } else {
                tryMonetagUpgrade(id, reward);
            }
        }

        function tryMonetagUpgrade(id, reward) {
            if(typeof show_10278425 === 'function') {
                show_10278425().then(()=>{ payUpgrade(id, reward); }).catch(()=>{ tg.showAlert("Error en construcci√≥n."); });
            } else { tg.showAlert("Error en construcci√≥n."); }
        }

        function payUpgrade(id, amount) {
            user.money += amount;
            user.timers[id] = Date.now() + COOLDOWN;
            save();
            tg.showPopup({ title:"¬°MEJORA INSTALADA!", message:`Valor del local: +${amount}` });
        }

        function retirar() {
            if(user.money < META) { tg.showAlert(`Caja insuficiente. Faltan $${META - user.money} para cierre.`); return; }
            let d = new Date();
            document.getElementById('recDate').innerText = d.toLocaleDateString();
            document.getElementById('recUser').innerText = tg.initDataUnsafe?.user?.first_name || "Gerente";
            document.getElementById('receiptModal').style.display = 'flex';
        }
    </script>
</body>
			</html>
