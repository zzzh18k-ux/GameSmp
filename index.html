<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Lucky Gift PRO</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* TEMA CASINO OSCURO */
        :root { --bg: #121212; --card: #1e1e1e; --gold: #FFD700; --accent: #b38728; }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: #000; color: white; font-family: 'Montserrat', sans-serif; 
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; 
            background-image: radial-gradient(circle, #222 0%, #000 100%); padding-bottom: 30px;
        }

        .app-container { width: 100%; max-width: 450px; padding: 20px; display: flex; flex-direction: column; align-items: center; }

        /* SALDO */
        .balance-card { 
            background: var(--card); width: 100%; border-radius: 16px; padding: 20px; 
            border: 1px solid var(--accent); text-align: center; margin-bottom: 20px; 
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
        }
        .stat-num { font-size: 40px; font-weight: 900; color: var(--gold); text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
        .stat-label { color: #888; font-size: 11px; letter-spacing: 2px; text-transform: uppercase; }

        /* TABLERO DE REGALOS (GRILLA) */
        .game-board { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; 
            width: 100%; margin-bottom: 25px; 
        }
        
        .gift-box {
            aspect-ratio: 1/1; /* Cuadrado perfecto */
            background: #252525; border-radius: 12px; border: 2px solid #333;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; position: relative; overflow: hidden;
            transition: transform 0.1s;
        }
        .gift-box:active { transform: scale(0.95); }
        .gift-icon { font-size: 35px; color: var(--gold); }
        
        /* ESTADOS DE LA CAJA */
        .gift-box.opened { background: #111; border-color: #444; }
        .gift-val { font-size: 18px; font-weight: bold; color: #fff; animation: popIn 0.3s ease; }
        .val-zero { color: #ef4444; } /* Rojo si es 0 */
        .val-win { color: #4ade80; } /* Verde si gana */

        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* BOTONES DE ABAJO */
        .btn-reset { 
            width: 100%; padding: 15px; background: #333; color: white; border: none; 
            border-radius: 10px; font-weight: bold; margin-bottom: 10px; cursor: pointer;
            display: none; /* Se oculta hasta que abran todos */
        }
        .btn-withdraw { 
            width: 100%; padding: 18px; border-radius: 12px; font-weight: 900; border: none; 
            cursor: pointer; background: linear-gradient(90deg, #fbbf24, #d97706); color: black; 
            font-size: 16px; text-transform: uppercase; box-shadow: 0 0 15px rgba(251, 191, 36, 0.4); 
        }

        /* MODAL RECIBO */
        #receiptModal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; justify-content:center; align-items:center; flex-direction:column; z-index:100; padding: 30px; }
        .modal-box { background: #1a1a1a; padding: 30px; border-radius: 20px; border: 1px solid var(--accent); width: 100%; text-align: center; }
        .receipt-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #444; padding: 8px 0; font-size: 13px; color: #ccc; }
        .receipt-val { color: var(--gold); font-weight: bold; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="balance-card">
            <div class="stat-label">TU SALDO</div>
            <div class="stat-num"><span id="saldo">0.00</span></div> 
            <div style="font-size:11px; color:#666;">META: 2,500 PUNTOS ($0.10)</div>
        </div>

        <div class="game-board" id="board">
            </div>

        <button class="btn-reset" id="resetBtn" onclick="resetBoard()">
            <i class="fa-solid fa-rotate-right"></i> JUGAR DE NUEVO
        </button>

        <div style="width:100%; display:flex; gap:10px; margin-bottom:15px;">
            <button style="flex:1; padding:10px; background:#151515; border:1px solid #333; color:#ccc; border-radius:8px;" onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')"><i class="fa-solid fa-headset"></i> Soporte</button>
            <button style="flex:1; padding:10px; background:#151515; border:1px solid #333; color:#ccc; border-radius:8px;" onclick="tg.openTelegramLink('https://t.me/noticebuddy')"><i class="fa-brands fa-telegram"></i> Canal</button>
        </div>

        <button class="btn-withdraw" onclick="retirar()">
            <i class="fa-solid fa-sack-dollar"></i> SOLICITAR PAGO
        </button>
    </div>

    <div id="receiptModal">
        <div class="modal-box">
            <h2 style="color:#10b981; margin-bottom:15px;">‚úÖ SOLICITUD ENVIADA</h2>
            <div class="receipt-row"><span>USUARIO:</span><span class="receipt-val" id="recUser">...</span></div>
            <div class="receipt-row"><span>FECHA:</span><span class="receipt-val" id="recDate">...</span></div>
            <div class="receipt-row"><span>HORA:</span><span class="receipt-val" id="recTime">...</span></div>
            <div class="receipt-row"><span>MONTO:</span><span class="receipt-val">2,500 PTS</span></div>
            <button style="background:#10b981; color:white; width:100%; padding:15px; border:none; border-radius:10px; margin-top:15px; font-weight:bold;" onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')">üì© ENVIAR AL DUE√ëO</button>
            <button style="background:transparent; border:none; color:#666; margin-top:15px;" onclick="location.reload()">Cerrar</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();

        const MEMORY_KEY = 'lucky_gift_v75';
        const MIN_WITHDRAW = 2500;
        
        let user = { balance: 0.00 };
        let openedCount = 0;

        // Cargar datos
        if(localStorage.getItem(MEMORY_KEY)) { 
            let saved = JSON.parse(localStorage.getItem(MEMORY_KEY));
            user.balance = parseFloat(saved.balance) || 0;
        }

        updateUI();
        initBoard();

        // --- PUBLICIDAD AUTOM√ÅTICA (CADA 60 SEGUNDOS) ---
        const AUTO_AD_TIME = 60000; // 60 segundos
        setInterval(() => {
            // Llama a Monetag
            if (typeof show_10278425 === 'function') {
                show_10278425().then(() => { console.log("Ad Auto"); }).catch(() => {});
            }
        }, AUTO_AD_TIME);

        function updateUI() { 
            // Mostrar 2 decimales siempre (Ej: 10.50)
            document.getElementById('saldo').innerText = user.balance.toFixed(2); 
        }
        function guardar() { localStorage.setItem(MEMORY_KEY, JSON.stringify(user)); updateUI(); }

        // --- L√ìGICA DEL JUEGO ---
        function initBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            openedCount = 0;
            document.getElementById('resetBtn').style.display = 'none';

            // Crear 10 Cajas (Bueno, 9 para que cuadre en grid 3x3, o 12. Haremos 9 para que se vea bonito 3x3)
            // El usuario pidi√≥ 10, pero en dise√±o grid queda un hueco. Haremos 12 cajas mejor.
            for(let i=0; i<12; i++) {
                let box = document.createElement('div');
                box.className = 'gift-box';
                box.innerHTML = '<i class="fa-solid fa-gift gift-icon"></i>';
                box.onclick = () => openBox(box);
                board.appendChild(box);
            }
        }

        function openBox(element) {
            // Si ya est√° abierta, no hacer nada
            if(element.classList.contains('opened')) return;

            element.classList.add('opened');
            
            // CALCULAR PREMIO (L√≥gica de Casino)
            // 40% probabilidad: 0 puntos (Vac√≠o)
            // 30% probabilidad: 0.10 puntos
            // 20% probabilidad: 0.20 puntos
            // 10% probabilidad: 0.50 puntos
            
            let rand = Math.random() * 100;
            let premio = 0;
            let claseColor = 'val-win';

            if (rand < 40) {
                premio = 0;
                claseColor = 'val-zero'; // Rojo
            } else if (rand < 70) {
                premio = 0.10;
            } else if (rand < 90) {
                premio = 0.20;
            } else {
                premio = 0.50;
            }

            // Mostrar resultado en la caja
            if (premio === 0) {
                element.innerHTML = `<span class="gift-val ${claseColor}">VAC√çO</span>`;
                tg.HapticFeedback.notificationOccurred('error');
            } else {
                element.innerHTML = `<span class="gift-val ${claseColor}">+${premio.toFixed(2)}</span>`;
                user.balance += premio;
                guardar();
                tg.HapticFeedback.impactOccurred('medium');
            }

            openedCount++;

            // Si abrieron todas (o casi todas), mostrar bot√≥n de reset
            if(openedCount >= 12) {
                document.getElementById('resetBtn').style.display = 'block';
            }
        }

        function resetBoard() {
            // Mostrar anuncio al reiniciar el tablero (Opcional, muy efectivo)
            if (typeof show_10278425 === 'function') {
                show_10278425();
            }
            initBoard();
        }

        // --- RETIRO ---
        function retirar() {
            if (user.balance < MIN_WITHDRAW) {
                tg.showAlert(`Faltan ${(MIN_WITHDRAW - user.balance).toFixed(2)} Puntos.`);
                return;
            }
            tg.showConfirm(`¬øRetirar 2,500 Puntos?`, (ok) => {
                if(ok) {
                    user.balance -= MIN_WITHDRAW;
                    guardar();
                    
                    let now = new Date();
                    document.getElementById('recDate').innerText = now.toLocaleDateString();
                    document.getElementById('recTime').innerText = now.toLocaleTimeString();
                    let username = tg.initDataUnsafe?.user?.first_name || "Usuario";
                    document.getElementById('recUser').innerText = username;

                    document.getElementById('receiptModal').style.display = 'flex';
                }
            });
        }
    </script>
</body>
</html>
