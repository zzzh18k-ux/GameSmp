<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fruit Hunter PRO üçì</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC50b1owYBLrmVUz2NqCnBDgsrIo80DFJE",
            authDomain: "fruithunter-b5d2d.firebaseapp.com",
            databaseURL: "https://fruithunter-b5d2d-default-rtdb.firebaseio.com",
            projectId: "fruithunter-b5d2d",
            storageBucket: "fruithunter-b5d2d.firebasestorage.app",
            messagingSenderId: "910354867578",
            appId: "1:910354867578:web:30c5a30058c621116622c3"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
    </script>

    <style>
        :root { --bg: #FFF3E0; --text-main: #5D4037; --accent: #FF6F00; --green: #43A047; }
        body { margin: 0; padding: 0; background: var(--bg); color: var(--text-main); font-family: 'Fredoka', sans-serif; overflow: hidden; user-select: none; -webkit-tap-highlight-color: transparent; }
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; pointer-events: none; display: flex; flex-direction: column; gap: 8px; }
        .toast { background: #fff; padding: 12px 20px; border-radius: 15px; font-size: 13px; font-weight: 600; border-left: 5px solid var(--accent); box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 10px; }
        #app-ui { padding: 20px; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .user-badge { background: #fff; padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); font-size: 12px; display: flex; align-items: center; gap: 8px; font-weight: 600; }
        .balance-card { background: #fff; border-radius: 25px; padding: 20px; text-align: center; margin-bottom: 15px; box-shadow: 0 10px 25px rgba(255, 111, 0, 0.15); border: 1px solid #FFE0B2; position: relative; }
        .balance-val { font-size: 42px; font-weight: 700; color: var(--accent); margin: 5px 0; }
        #daily-btn { position: absolute; top: 10px; right: 10px; background: #FFD700; border: none; padding: 5px 10px; border-radius: 15px; font-size: 10px; font-weight: bold; cursor: pointer; box-shadow: 0 3px 0 #F9A825; animation: bounce 2s infinite; display: none; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        .energy-box { background: #fff; padding: 12px 20px; border-radius: 20px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .energy-dots { display: flex; gap: 4px; }
        .dot { width: 8px; height: 12px; background: #FFE0B2; border-radius: 4px; }
        .dot.active { background: var(--accent); height: 16px; }
        .btn-play { width: 100%; border: none; padding: 20px; border-radius: 20px; font-size: 18px; font-weight: 700; color: #fff; background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); box-shadow: 0 10px 20px rgba(255, 152, 0, 0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: auto; }
        .menu-btn { background: #fff; border: none; padding: 15px; border-radius: 18px; color: #8D6E63; font-size: 11px; font-weight: 700; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; box-shadow: 0 5px 10px rgba(0,0,0,0.05); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(93, 64, 55, 0.8); z-index: 200; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background: #fff; width: 85%; padding: 30px 25px; border-radius: 30px; text-align: center; position: relative; }
        .modal-close { position: absolute; top: 15px; right: 15px; border: none; background: none; font-size: 20px; color: #aaa; cursor: pointer; }
        .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #eee; font-size: 13px; }
        input { width: 100%; padding: 15px; margin: 15px 0; background: #FFF3E0; border: 2px solid #FFE0B2; border-radius: 15px; font-size: 16px; box-sizing: border-box; outline: none; }
        #game-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #212121; z-index: 100; display: none; }
        .hud { position: absolute; top: 40px; width: 100%; padding: 0 30px; display: flex; justify-content: space-between; box-sizing: border-box; pointer-events: none; }
    </style>
</head>
<body>
    <div id="toast-container"></div>
    <div id="loading-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); z-index:999; display:flex; justify-content:center; align-items:center; flex-direction:column;">
        <i class="fas fa-circle-notch fa-spin" style="font-size:40px; color:var(--accent);"></i>
        <p style="margin-top:20px; font-weight:bold;">Conectando con el Banco...</p>
    </div>

    <div id="app-ui" style="display:none;">
        <div class="header">
            <div class="user-badge"><i class="fas fa-user-circle" style="color:var(--accent)"></i> <span id="username">...</span></div>
            <div class="user-badge"><i class="fas fa-users"></i> <span id="my-ref-count">0</span></div>
        </div>
        <div class="balance-card">
            <button id="daily-btn" onclick="claimDaily()">üéÅ RECLAMAR</button>
            <div style="font-size:11px; font-weight:bold; color:#8D6E63;">TU SALDO TOTAL</div>
            <div class="balance-val">$<span id="ui-usd">0.0000</span></div>
            <div style="font-size:12px; background:#F5F5F5; display:inline-block; padding:4px 10px; border-radius:10px; color:#aaa;">USDT (Polygon)</div>
        </div>
        <div class="energy-box">
            <div style="font-size:12px; font-weight:bold; color:var(--text-main);">‚ö° ENERG√çA</div>
            <div class="energy-dots" id="energy-bar"></div>
            <div style="font-size:12px; font-weight:bold; color:#8D6E63;"><span id="energy-num">10</span>/10</div>
        </div>
        <button id="btn-play" class="btn-play" onclick="preGameAd()">
            <i class="fas fa-play-circle"></i> ¬°JUGAR AHORA!
        </button>
        <div class="menu-grid">
            <button class="menu-btn" onclick="openModal('modalWithdraw')"><i class="fas fa-wallet" style="color:#43A047; font-size: 20px;"></i> RETIRAR</button>
            <button class="menu-btn" onclick="openModal('modalInvite')"><i class="fas fa-gift" style="color:#1E88E5; font-size: 20px;"></i> INVITAR</button>
            <button class="menu-btn" onclick="tg.openTelegramLink('https://t.me/YougamefavoriteBot')"><i class="fab fa-telegram" style="color:#039BE5; font-size: 20px;"></i> CANAL</button>
        </div>
    </div>

    <div id="game-layer">
        <div class="hud">
            <div style="color:#FFD700; font-weight:900; font-size:24px;"><i class="fas fa-star"></i> <span id="score-val">0</span></div>
            <div style="color:#fff; font-weight:900; font-size:24px;"><i class="fas fa-clock"></i> <span id="time-val">45</span></div>
        </div>
        <canvas id="canvas"></canvas>
    </div>

    <div id="modalInvite" class="modal-overlay">
        <div class="modal-box">
            <button class="modal-close" onclick="closeModals()">&times;</button>
            <i class="fas fa-users" style="font-size: 40px; color: #1E88E5; margin-bottom: 10px;"></i>
            <h3 style="margin:0; color:var(--text-main);">INVITA Y GANA</h3>
            <p style="font-size:13px; color:#8D6E63; margin-bottom: 20px;">Env√≠a tu enlace a tus amigos.</p>
            <div style="background:#F5F5F5; padding: 15px; border-radius: 15px; text-align: left; margin-bottom: 20px;">
                <div class="info-row"><span>1. T√∫ invitas a un amigo</span><i class="fas fa-check" style="color:var(--green)"></i></div>
                <div class="info-row"><span>2. Tu amigo juega 50 veces</span><i class="fas fa-gamepad" style="color:var(--accent)"></i></div>
                <div class="info-row" style="border:none; font-weight: bold; color:var(--green);"><span>3. ¬°T√ö GANAS $0.05!</span><span>üí∞</span></div>
            </div>
            <button class="btn-play" style="font-size:14px; padding:15px;" onclick="copyLink()"><i class="fas fa-copy"></i> COPIAR ENLACE</button>
        </div>
    </div>

    <div id="modalWithdraw" class="modal-overlay">
        <div class="modal-box">
            <button class="modal-close" onclick="closeModals()">&times;</button>
            <h3 style="margin:0; color:var(--text-main);">RETIRAR DINERO</h3>
            <p style="font-size:12px; color:#8D6E63;">M√≠nimo $5.00 USDT</p>
            <input type="number" id="w-amount" placeholder="Monto a retirar">
            <input type="text" id="w-wallet" placeholder="Tu Billetera (Polygon)">
            <button class="btn-play" style="font-size:14px; padding:15px; margin-top:10px;" onclick="processWithdraw()">ENVIAR SOLICITUD</button>
        </div>
    </div>
        <script>
        const tg = window.Telegram.WebApp;
        try { tg.expand(); } catch (e) {}

        const BOT_TOKEN = "8575758761:AAHM8aRoDIee_iICu4zwSYBuHJcyy7CXH_s"; 
        const CHAT_ID = "-1002118088046"; 
        const ADSGRAM_ID = "18897"; 
        const REF_GOAL = 50;
        const REF_PAY = 0.05; 
        const OLD_KEY = 'fruit_hunter_v13_multi_block';

        // üß† L√ìGICA DE IDENTIFICACI√ìN INTELIGENTE
        // Si no hay Telegram, busca si ya ten√≠amos un ID de prueba guardado para no bloquearnos al refrescar.
        let telegramID = tg.initDataUnsafe?.user?.id;
        let testID = localStorage.getItem('fh_test_id');
        if (!telegramID && !testID) {
            testID = "TEST_" + Math.floor(Math.random()*100000);
            localStorage.setItem('fh_test_id', testID);
        }
        let uid = telegramID || testID || "UNKNOWN";
        
        let user = { usd:0, dailyGames:10, totalGames:0, lastLogin:"", lastReward:"" };

        // üõ°Ô∏è SISTEMA DE SEGURIDAD
        function checkSecurity() {
            // 1. BLOQUEO DE PC (Agresivo)
            const platform = tg.platform || "unknown";
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            // Detectar m√≥viles de forma estricta
            const isMobile = /android|avantgo|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|smartphone|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(userAgent);
            
            // Si NO es m√≥vil y NO estamos dentro de la App de Telegram Android/iOS -> FUERA
            // NOTA: Si quieres probar en PC, comenta estas l√≠neas temporalmente.
            if (!isMobile && platform !== 'android' && platform !== 'ios') {
                document.body.innerHTML = `
                    <div style="background:#000; color:#fff; height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:20px; font-family:sans-serif;">
                        <i class="fas fa-mobile-alt" style="font-size:60px; color:#FF3D00; margin-bottom:20px;"></i>
                        <h2 style="text-transform:uppercase;">Solo en Celular</h2>
                        <p>Fruit Hunter PRO fue dise√±ado exclusivamente para tel√©fonos m√≥viles.</p>
                        <p style="color:#666; font-size:12px; margin-top:10px;">Acceso desde PC bloqueado.</p>
                    </div>`;
                return false; 
            }

            // 2. BLOQUEO MULTI-CUENTA (En el mismo dispositivo)
            let deviceLock = localStorage.getItem('fh_device_lock');
            
            // Si el dispositivo ya tiene due√±o y NO SOY YO -> BLOQUEO
            if (deviceLock && deviceLock !== String(uid)) {
                 document.body.innerHTML = `
                    <div style="background:#B71C1C; color:#fff; height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:20px; font-family:sans-serif;">
                        <i class="fas fa-user-shield" style="font-size:60px; color:#fff; margin-bottom:20px;"></i>
                        <h2>ACCESO DENEGADO</h2>
                        <p>Este dispositivo ya est√° vinculado a otra cuenta.</p>
                        <div style="background:rgba(0,0,0,0.3); padding:10px; border-radius:10px; margin-top:20px; font-size:11px;">
                            ID Dispositivo: ${deviceLock}<br>
                            Tu ID Actual: ${uid}
                        </div>
                    </div>`;
                reportar(`üö® SEGURIDAD: Multi-cuenta detectada. Intruso: ${uid} (Due√±o: ${deviceLock})`);
                return false; 
            }
            
            // Si pasamos, firmamos el dispositivo como nuestro
            localStorage.setItem('fh_device_lock', uid);
            return true;
        }

        function init() {
            // EJECUTAR SEGURIDAD PRIMERO
            if(!checkSecurity()) return;

            const userRef = db.ref('users/' + uid);
            userRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (!data) {
                    let savedOld = localStorage.getItem(OLD_KEY);
                    let datosAUsar = { usd: 2.00, dailyGames: 10, totalGames: 0, lastLogin: new Date().toLocaleDateString(), lastReward: "" };
                    if (savedOld) {
                        try {
                            let oldUser = JSON.parse(savedOld);
                            datosAUsar.usd = oldUser.usd || 2.00;
                            datosAUsar.totalGames = oldUser.totalGamesEver || 0; 
                            showToast("‚ôªÔ∏è Saldo recuperado", "fas fa-check", "#43A047");
                        } catch(e) {}
                    }
                    const startParam = tg.initDataUnsafe?.start_param;
                    if (startParam && startParam.startsWith('ref_')) {
                        let padreID = startParam.split('_')[1];
                        if(padreID != uid) datosAUsar.referrer = padreID;
                    }
                    userRef.set(datosAUsar);
                    user = datosAUsar;
                } else {
                    user = data;
                    let today = new Date().toLocaleDateString();
                    if(user.lastLogin !== today) userRef.update({ dailyGames: 10, lastLogin: today });
                }
                document.getElementById('loading-screen').style.display='none';
                document.getElementById('app-ui').style.display='flex';
                updateUI();
                checkDailyButton();
            });
        }

        function checkDailyButton() {
            let today = new Date().toLocaleDateString();
            if (user.lastReward !== today) document.getElementById('daily-btn').style.display = 'block';
            else document.getElementById('daily-btn').style.display = 'none';
        }

        function claimDaily() {
            user.usd = (user.usd || 0) + 0.01;
            user.lastReward = new Date().toLocaleDateString();
            showToast("üéÅ ¬°Ganaste $0.01 Bono Diario!", "fas fa-gift", "#FFD700");
            saveCloud();
            document.getElementById('daily-btn').style.display = 'none';
        }

        function saveCloud() {
            db.ref('users/' + uid).update({
                usd: user.usd, dailyGames: user.dailyGames, totalGames: user.totalGames, lastReward: user.lastReward || ""
            });
        }

        function checkReferralPay() {
            if(user.totalGames === REF_GOAL && user.referrer) {
                db.ref('users/' + user.referrer).transaction((padreData) => {
                    if (padreData) { padreData.usd = (padreData.usd || 0) + REF_PAY; return padreData; }
                    return padreData;
                }, (error, committed) => { if (committed) reportar(`üí∞ PAGO REF: $${REF_PAY} a ${user.referrer}`); });
            }
        }

        function preGameAd() {
            if(user.dailyGames <= 0) return showToast("Vuelve ma√±ana por m√°s energ√≠a.", "fas fa-bed", "#E53935");
            try { window.Adsgram.init({ blockId: ADSGRAM_ID }).show().then(() => { startGame(); }).catch(() => { startGame(); }); } catch(e) { startGame(); }
        }

        const cvs = document.getElementById('canvas');
        const ctx = cvs.getContext('2d');
        let game = { run:false, score:0, time:45, hook:{}, objs:[] };
        let loopId;

        function startGame() {
            document.getElementById('game-layer').style.display='block';
            cvs.width = window.innerWidth; cvs.height = window.innerHeight;
            game.objs = [];
            for(let i=0;i<5;i++) game.objs.push({x:Math.random()*cvs.width, y:150+Math.random()*400, r:25, val:50, icon:'üçì', spd:4});
            game.hook = {x:cvs.width/2, y:50, ang:1.57, len:60, st:0, spd:0.03, obj:null};
            game.score=0; game.time=45; game.run=true;
            cvs.onpointerdown = () => { if(game.hook.st===0) game.hook.st=1; };
            loop();
        }

        function loop() {
            if(!game.run) return;
            let h = game.hook;
            if(h.st===0) { h.ang+=h.spd; if(h.ang<0.2||h.ang>2.9) h.spd*=-1; }
            else if(h.st===1) { h.len+=15; if(h.len>cvs.height) h.st=2; let hx=h.x+Math.cos(h.ang)*h.len, hy=h.y+Math.sin(h.ang)*h.len; for(let o of game.objs) { if(!o.caught && Math.hypot(hx-o.x, hy-o.y)<o.r) { o.caught=true; h.obj=o; h.st=2; break; } } } 
            else { h.len-=10; if(h.len<=60) { h.len=60; h.st=0; if(h.obj){ game.score+=h.obj.val; h.obj=null; } } }
            ctx.fillStyle='#212121'; ctx.fillRect(0,0,cvs.width,cvs.height);
            for(let o of game.objs) { if(!o.caught) { ctx.font="35px Arial"; ctx.textAlign="center"; ctx.textBaseline="middle"; ctx.fillText(o.icon, o.x, o.y); } }
            let hx=h.x+Math.cos(h.ang)*h.len, hy=h.y+Math.sin(h.ang)*h.len;
            ctx.strokeStyle='#fff'; ctx.lineWidth=3; ctx.beginPath(); ctx.moveTo(h.x,h.y); ctx.lineTo(hx,hy); ctx.stroke();
            ctx.fillStyle='#E53935'; ctx.beginPath(); ctx.arc(hx,hy,6,0,6.28); ctx.fill();
            if(h.obj) ctx.fillText(h.obj.icon, hx, hy+20);
            game.time-=0.03; 
            document.getElementById('score-val').innerText=game.score;
            document.getElementById('time-val').innerText=Math.ceil(game.time);
            if(game.time<=0) endGame(); else loopId=requestAnimationFrame(loop);
        }

        function endGame() {
            cancelAnimationFrame(loopId);
            document.getElementById('game-layer').style.display='none';
            user.dailyGames--; user.totalGames++;
            let prize = (game.score * 0.00005);
            user.usd += prize; 
            saveCloud(); checkReferralPay();
            showToast(`üçì ¬°Ganaste $${prize.toFixed(4)}!`, "fas fa-check", "#43A047");
        }

        function processWithdraw() {
            let amt = parseFloat(document.getElementById('w-amount').value);
            let wallet = document.getElementById('w-wallet').value;
            if(amt < 5.00) return showToast("M√≠nimo $5.00", "fas fa-lock", "#E53935");
            if(amt > user.usd) return showToast("Saldo insuficiente", "fas fa-chart-line", "#E53935");
            user.usd -= amt; saveCloud();
            reportar(`üí∏ RETIRO: $${amt} | ${wallet}`);
            closeModals(); showToast("Solicitud enviada", "fas fa-clock", "#FF6F00");
        }

        function copyLink() { 
            const link = `https://t.me/YougamefavoriteBot?startapp=ref_${uid}`;
            navigator.clipboard.writeText(link); showToast("Enlace copiado", "fas fa-link", "#5D4037"); 
        }

        function reportar(msg) { try { fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(msg)}`); } catch(e){} }
        function showToast(msg, icon, col) { const t = document.createElement('div'); t.className='toast'; t.style.borderLeftColor=col; t.innerHTML=`<i class="${icon}" style="color:${col}; font-size:18px;"></i> <span>${msg}</span>`; document.getElementById('toast-container').appendChild(t); setTimeout(()=>t.remove(), 4000); }
        function openModal(id){ document.getElementById(id).style.display='flex'; }
        function closeModals(){ document.querySelectorAll('.modal-overlay').forEach(e=>e.style.display='none'); }
        function updateUI() { 
            document.getElementById('ui-usd').innerText= (user.usd || 0).toFixed(4); 
            document.getElementById('username').innerText = tg.initDataUnsafe?.user?.first_name || "Cazador";
            document.getElementById('energy-num').innerText = user.dailyGames;
            document.getElementById('my-ref-count').innerText = user.referrer ? "1" : "0"; 
            let dots = ""; for(let i=0; i<10; i++) dots += `<div class="dot ${i < user.dailyGames ? 'active' : ''}"></div>`;
            document.getElementById('energy-bar').innerHTML = dots;
        }
        window.onload = init;
    </script>
</body>
</html>
