<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Lucky Gift PRO</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* TEMA DARK GOLD */
        :root { --bg: #000000; --card: #151515; --gold: #FFD700; --bar-bg: #333; }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: var(--bg); color: white; font-family: 'Montserrat', sans-serif; 
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; 
            padding-bottom: 30px;
        }

        /* PANTALLA DE BANEO */
        #banScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 99999; display: none;
            flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 30px;
        }
        .ban-icon { font-size: 60px; color: #dc2626; margin-bottom: 20px; }
        .ban-title { font-size: 24px; color: #dc2626; font-weight: bold; margin-bottom: 10px; }
        .ban-text { color: #fff; font-size: 14px; line-height: 1.5; }

        .app-container { width: 100%; max-width: 450px; padding: 20px; display: flex; flex-direction: column; align-items: center; }

        /* BARRA DE PROGRESO */
        .progress-container {
            width: 100%; background: var(--card); padding: 20px; border-radius: 20px;
            border: 1px solid #333; margin-bottom: 25px; margin-top: 15px;
            text-align: center;
        }
        .progress-label { font-size: 12px; color: #888; margin-bottom: 10px; letter-spacing: 1px; }
        
        .progress-track {
            width: 100%; height: 25px; background: #222; border-radius: 15px;
            overflow: hidden; position: relative; border: 1px solid #444;
        }
        .progress-fill {
            height: 100%; width: 0%; 
            background: linear-gradient(90deg, #fbbf24, #d97706);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }
        .progress-text {
            margin-top: 8px; font-size: 14px; font-weight: bold; color: var(--gold);
            display: flex; justify-content: space-between;
        }

        /* TABLERO DE REGALOS (GRILLA 3x4) */
        .game-board { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; 
            width: 100%; margin-bottom: 25px; 
        }
        
        .gift-box {
            aspect-ratio: 1/1; 
            background: #1a1a1a; border-radius: 12px; border: 2px solid #333;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; position: relative; overflow: hidden;
            transition: transform 0.1s;
        }
        .gift-box:active { transform: scale(0.95); }
        .gift-icon { font-size: 32px; color: #555; transition: color 0.3s;}
        
        /* ESTADOS DE LA CAJA */
        .gift-box:hover .gift-icon { color: var(--gold); }
        .gift-box.opened { background: #111; border-color: #222; }
        .gift-val { font-size: 16px; font-weight: 900; animation: popIn 0.3s ease; }
        
        /* COLORES DE RESULTADO */
        .val-zero { color: #ef4444; text-shadow: 0 0 5px rgba(239, 68, 68, 0.5); } /* ROJO VAC√çO */
        .val-win { color: #4ade80; text-shadow: 0 0 5px rgba(74, 222, 128, 0.5); } /* VERDE PUNTOS */
        .val-jackpot { color: #FFD700; font-size: 20px; text-shadow: 0 0 15px #FFD700; } /* DORADO WOW */

        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* BOTONES */
        .btn-reset { 
            width: 100%; padding: 15px; background: #333; color: white; border: none; 
            border-radius: 10px; font-weight: bold; margin-bottom: 10px; cursor: pointer;
            display: none; 
        }
        .btn-withdraw { 
            width: 100%; padding: 18px; border-radius: 12px; font-weight: 900; border: none; 
            cursor: pointer; background: #444; color: #888; /* Desactivado por defecto */
            font-size: 16px; text-transform: uppercase; 
            display: flex; justify-content: center; align-items: center; gap: 10px;
            pointer-events: none; /* No clickable */
        }
        
        /* Bot√≥n Activo cuando llega a la meta */
        .btn-withdraw.active {
            background: linear-gradient(90deg, #10b981, #059669); color: white;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
            pointer-events: all; cursor: pointer;
        }
        
        /* BOTONES PEQUE√ëOS */
        .mini-menu { width:100%; display:flex; gap:10px; margin-bottom:15px; }
        .btn-small { flex:1; padding:12px; background:#151515; border:1px solid #333; color:#ccc; border-radius:8px; cursor: pointer; display: flex; justify-content: center; gap: 5px; font-size: 12px; font-weight: bold;}

        /* MODAL RECIBO */
        #receiptModal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; justify-content:center; align-items:center; flex-direction:column; z-index:100; padding: 30px; }
        .modal-box { background: #1a1a1a; padding: 30px; border-radius: 20px; border: 1px solid var(--gold); width: 100%; text-align: center; }
        .receipt-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #444; padding: 8px 0; font-size: 13px; color: #ccc; }
        .receipt-val { color: var(--gold); font-weight: bold; }
    </style>
</head>
<body>

    <div id="banScreen">
        <i class="fa-solid fa-ban ban-icon"></i>
        <div class="ban-title">ACCESO DENEGADO</div>
        <p class="ban-text">Dispositivo vinculado a otra cuenta.<br>ID: <span id="linkedID" style="color:#fbbf24">...</span></p>
    </div>

    <div class="app-container" id="appContent">
        
        <div class="progress-container">
            <div class="progress-label">TU PROGRESO PARA RETIRAR</div>
            <div class="progress-track">
                <div class="progress-fill" id="progBar"></div>
            </div>
            <div class="progress-text">
                <span id="ptsDisplay">0 Pts</span>
                <span style="color:#4ade80; font-weight:900;">$0.10 <i class="fa-solid fa-flag-checkered"></i></span>
            </div>
        </div>

        <div class="game-board" id="board"></div>

        <button class="btn-reset" id="resetBtn" onclick="resetBoard()">
            <i class="fa-solid fa-rotate-right"></i> JUGAR DE NUEVO
        </button>

        <div class="mini-menu">
            <button class="btn-small" onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')"><i class="fa-solid fa-headset"></i> Soporte</button>
            <button class="btn-small" onclick="tg.openTelegramLink('https://t.me/noticebuddy')"><i class="fa-brands fa-telegram"></i> Canal</button>
        </div>

        <button class="btn-withdraw" id="withdrawBtn" onclick="retirar()">
            <i class="fa-solid fa-lock"></i> META NO ALCANZADA
        </button>
    </div>

    <div id="receiptModal">
        <div class="modal-box">
            <h2 style="color:#10b981; margin-bottom:15px;">‚úÖ META COMPLETADA</h2>
            <p style="color:#fff; font-size:12px; margin-bottom:15px;">¬°Felicidades! Env√≠a la captura para cobrar.</p>
            <div class="receipt-row"><span>USUARIO:</span><span class="receipt-val" id="recUser">...</span></div>
            <div class="receipt-row"><span>FECHA:</span><span class="receipt-val" id="recDate">...</span></div>
            <div class="receipt-row"><span>HORA:</span><span class="receipt-val" id="recTime">...</span></div>
            <div class="receipt-row"><span>MONTO:</span><span class="receipt-val">$0.10 USD</span></div>
            <button style="background:#10b981; color:white; width:100%; padding:15px; border:none; border-radius:10px; margin-top:15px; font-weight:bold;" onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')">üì© COBRAR AHORA</button>
            <button style="background:transparent; border:none; color:#666; margin-top:15px;" onclick="location.reload()">Cerrar</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();

        const ADSGRAM_ID = "18841"; 
        const MEMORY_KEY = 'lucky_pro_v78';
        const META_PUNTOS = 2500; // $0.10 USD
        
        let user = { points: 0 };
        let openedCount = 0;

        // --- SEGURIDAD ---
        window.onload = function() {
            const currentID = tg.initDataUnsafe?.user?.id || 12345; 
            const savedID = localStorage.getItem('device_owner_id');

            if (savedID && savedID != currentID) {
                document.getElementById('appContent').style.display = 'none';
                document.getElementById('banScreen').style.display = 'flex';
                document.getElementById('linkedID').innerText = savedID;
                return; 
            } 
            if (!savedID) { localStorage.setItem('device_owner_id', currentID); }

            if(localStorage.getItem(MEMORY_KEY)) { 
                let saved = JSON.parse(localStorage.getItem(MEMORY_KEY));
                user.points = parseFloat(saved.points) || 0;
            }
            updateUI();
            initBoard();
        };

        // --- PUBLICIDAD AUTOM√ÅTICA (CADA 60s) ---
        setInterval(() => {
            if (typeof show_10278425 === 'function') show_10278425().catch(()=>{});
        }, 60000);

        // --- UI ---
        function updateUI() { 
            let porcentaje = (user.points / META_PUNTOS) * 100;
            if(porcentaje > 100) porcentaje = 100;

            document.getElementById('progBar').style.width = porcentaje + "%";
            document.getElementById('ptsDisplay').innerText = Math.floor(user.points) + " / " + META_PUNTOS;

            const btn = document.getElementById('withdrawBtn');
            if (user.points >= META_PUNTOS) {
                btn.classList.add('active');
                btn.innerHTML = '<i class="fa-solid fa-sack-dollar"></i> SOLICITAR $0.10';
            } else {
                btn.classList.remove('active');
                btn.innerHTML = `<i class="fa-solid fa-lock"></i> FALTA ${Math.floor(100 - porcentaje)}%`;
            }
        }

        function guardar() { localStorage.setItem(MEMORY_KEY, JSON.stringify(user)); updateUI(); }

        // --- JUEGO ---
        function initBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            openedCount = 0;
            document.getElementById('resetBtn').style.display = 'none';

            for(let i=0; i<12; i++) {
                let box = document.createElement('div');
                box.className = 'gift-box';
                box.innerHTML = '<i class="fa-solid fa-gift gift-icon"></i>';
                box.onclick = () => tryShowAdThenOpen(box);
                board.appendChild(box);
            }
        }

        function tryShowAdThenOpen(box) {
            if(box.classList.contains('opened')) return;

            // 50% probabilidad de mostrar anuncio
            if (Math.random() < 0.5) {
                // ALEATORIO: Adsgram vs Monetag
                if (Math.random() < 0.5) {
                    const AdController = window.Adsgram.init({ blockId: ADSGRAM_ID });
                    AdController.show().then(() => openBox(box)).catch(() => openBox(box));
                } else {
                    if (typeof show_10278425 === 'function') {
                        show_10278425().then(() => openBox(box)).catch(() => openBox(box));
                    } else {
                        openBox(box);
                    }
                }
            } else {
                openBox(box);
            }
        }

        function openBox(element) {
            if(element.classList.contains('opened')) return;
            element.classList.add('opened');
            
            // --- MATEM√ÅTICA RENTABLE (V78) ---
            let rand = Math.random() * 100;
            let pts = 0;
            let htmlContent = '';

            // 45% -> VAC√çO (ROJO)
            if (rand < 45) {
                pts = 0;
                htmlContent = `<span class="gift-val val-zero">VAC√çO</span>`;
                tg.HapticFeedback.notificationOccurred('error');
            } 
            // 45% -> BAJO (2 a 5 pts) (VERDE)
            else if (rand < 90) {
                pts = Math.floor(Math.random() * (5 - 2 + 1)) + 2;
                htmlContent = `<span class="gift-val val-win">+${pts}</span>`;
                tg.HapticFeedback.impactOccurred('medium');
            } 
            // 9% -> MEDIO (8 a 12 pts) (VERDE)
            else if (rand < 99) {
                pts = Math.floor(Math.random() * (12 - 8 + 1)) + 8;
                htmlContent = `<span class="gift-val val-win">+${pts}</span>`;
                tg.HapticFeedback.impactOccurred('medium');
            } 
            // 1% -> JACKPOT (50 pts) (DORADO)
            else {
                pts = 50;
                htmlContent = `<span class="gift-val val-jackpot">+${pts}</span>`;
                tg.showAlert("¬°GOLPE DE SUERTE! üåü +50 Puntos");
                tg.HapticFeedback.notificationOccurred('success');
            }

            element.innerHTML = htmlContent;
            
            if (pts > 0) {
                user.points += pts;
                guardar();
            }

            openedCount++;
            if(openedCount >= 12) document.getElementById('resetBtn').style.display = 'block';
        }

        function resetBoard() {
            // Anuncio extra al resetear (20% chance)
            if (Math.random() < 0.2 && typeof show_10278425 === 'function') show_10278425();
            initBoard();
        }

        function retirar() {
            if (user.points < META_PUNTOS) return;
            
            tg.showConfirm(`¬øCobrar $0.10 ahora?`, (ok) => {
                if(ok) {
                    user.points -= META_PUNTOS;
                    guardar();
                    
                    let now = new Date();
                    document.getElementById('recDate').innerText = now.toLocaleDateString();
                    document.getElementById('recTime').innerText = now.toLocaleTimeString();
                    document.getElementById('recUser').innerText = tg.initDataUnsafe?.user?.first_name || "Usuario";
                    document.getElementById('receiptModal').style.display = 'flex';
                }
            });
        }
    </script>
</body>
    </html>
